<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MedHub Attendance Tracker</title>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     Minimal CSS (unchanged except elements
     related to the deleted QR-input removed)
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<style>
:root{
  --font-family-base:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',sans-serif;
  --color-primary:#0066cc; --color-success:#006600; --color-warning:#cc7000;
  --color-border:#ccc;     --color-border-light:#ddd; --color-border-focus:#4d90fe;
  --background-color-body:#f4f6f8;   --background-color-container:#fff;
  --background-color-input:#fff;     --background-color-input-focus-shadow:rgba(77,144,254,.2);
  --background-color-action-log:#f8f8f8;
  --background-color-button:#f0f0f0;   --background-color-button-hover:#e0e0e0;
  --background-color-lecture-button:#e6f2ff; --background-color-lecture-button-hover:#cce6ff;
  --background-color-status-setup:#f0f8ff; --background-color-status-attendance:#f0fff0;
  --background-color-success-flash-start:#90EE90;
  --border-radius-small:6px; --border-radius-medium:8px; --border-radius-large:12px;
  --box-shadow-container:0 4px 12px rgba(0,0,0,.1); --box-shadow-input-inset:inset 0 1px 3px rgba(0,0,0,.1);
  --padding-small:10px; --padding-medium:12px; --padding-large:15px; --padding-xlarge:20px;
  --log-success:#2c7c26; --log-warning:#cc7000; --log-info:#0066cc;
}
body{font-family:var(--font-family-base);max-width:800px;margin:0 auto;
     padding:var(--padding-xlarge);line-height:1.4;background:var(--background-color-body)}
.container{border:1px solid var(--color-border);border-radius:var(--border-radius-large);
           padding:var(--padding-xlarge);box-shadow:var(--box-shadow-container);
           background:var(--background-color-container)}
.status{font-weight:bold;padding:var(--padding-medium);border-radius:var(--border-radius-small);
        margin-bottom:var(--padding-large);text-align:center;font-size:18px}
.setup-mode .status{background:var(--background-color-status-setup);color:var(--color-primary)}
.attendance-mode .status{background:var(--background-color-status-attendance);color:var(--color-success)}
.lecture-info{margin-bottom:var(--padding-large);font-weight:bold}
input{width:calc(100% - 24px);padding:var(--padding-medium);margin:var(--padding-large) 0;
      border:1px solid var(--color-border);border-radius:var(--border-radius-medium);
      font-size:16px;box-shadow:var(--box-shadow-input-inset);background:var(--background-color-input)}
input:focus{outline:none;border-color:var(--color-border-focus);
            box-shadow:0 0 0 2px var(--background-color-input-focus-shadow),var(--box-shadow-input-inset)}
.action-log{margin-top:var(--padding-large);padding:var(--padding-medium);
            background:var(--background-color-action-log);border-radius:var(--border-radius-medium);
            min-height:60px;max-height:200px;overflow-y:auto;font-size:14px;
            border:1px solid var(--color-border-light)}
.action-log>div{padding:4px 0;border-bottom:1px solid var(--color-border-light)}
.action-log>div:last-child{border-bottom:none}
.scan-count{margin-top:var(--padding-medium);font-weight:bold}
button{background:var(--background-color-button);border:1px solid var(--color-border);
       padding:var(--padding-medium) var(--padding-large);border-radius:var(--border-radius-medium);
       cursor:pointer;margin-top:var(--padding-medium);width:100%;font-size:16px;font-weight:500;
       transition:background .2s}
button:hover,button:focus{background:var(--background-color-button-hover);outline:none}
button.lecture-btn{background:var(--background-color-lecture-button);border-color:var(--color-primary);
                   color:var(--color-primary);margin-bottom:var(--padding-small)}
button.lecture-btn:hover,button.lecture-btn:focus{background:var(--background-color-lecture-button-hover)}
.hidden{display:none}
.success-flash{animation:flash-green 1s}
@keyframes flash-green{0%{background:var(--background-color-success-flash-start)}
 100%{background:var(--background-color-container)}}
.log-success{color:var(--log-success)} .log-warning{color:var(--log-warning)}
.log-info{color:var(--log-info)}
@media(max-width:768px){body{padding:var(--padding-large)} .container{padding:var(--padding-large)}}
@media(max-width:480px){body{padding:var(--padding-small)} .container{padding:var(--padding-medium)}}
</style>
</head>
<body>

<div class="container setup-mode" id="mainContainer">
  <div class="status" id="statusDisplay" aria-live="polite">SELECT LECTURE TYPE</div>

  <div id="setupSection">
    <div class="lecture-section">
      <p>Select lecture type:</p>
      <div class="lecture-buttons" id="lectureButtons"></div>
    </div>
  </div>

  <div id="attendanceSection" class="hidden">
    <div class="lecture-info" id="lectureInfo">Lecture: Not set</div>
    <p>Ready for badge scans</p>
    <div class="scan-count" id="scanCount">Total scans: 0</div>
    <input type="text" id="badgeScanInput" placeholder="Scan badge here" autocomplete="off">
    <button id="resetButton">RESETÂ /Â NEWÂ LECTURE</button>
  </div>

  <div class="action-log" id="actionLog" aria-live="polite"></div>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     Inline JS
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  /* ---------- Config ------------------ */
  const CFG={
    MEDHUB_PROXY_URL:'/proxy-to-medhub',
    DEVICE_ID:'134',SID:'704',UDID:'301ad0e3bd',USER_ID:'codereadrTestUDID',
    LECTURES:[
      {n:'MKSAP',c:'MH-AUTO-curriculumID:13'},
      {n:'Noon Conference',c:'MH-AUTO-curriculumID:5'},
      {n:'Grand Rounds',c:'MH-AUTO-curriculumID:2'},
      {n:'SIM LAB',c:'MH-AUTO-curriculumID:529'},
      {n:'Academic Block',c:'MH-AUTO-curriculumID:392'},
      {n:'Board Review',c:'MH-AUTO-curriculumID:7'},
      {n:'Guidelines',c:'MH-AUTO-curriculumID:397'},
      {n:'Journal Club',c:'MH-AUTO-curriculumID:3'},
      {n:'Workshop',c:'MH-AUTO-curriculumID:9'},
      {n:'Intern School',c:'MH-AUTO-curriculumID:12'}
    ],
    FLASH_TIME:1e3
  };

  /* ---------- DOM helpers ------------- */
  const el=id=>document.getElementById(id);
  const cont=el('mainContainer'),status=el('statusDisplay'),
        setupSec=el('setupSection'),attSec=el('attendanceSection'),
        lectureInfo=el('lectureInfo'),badgeIn=el('badgeScanInput'),
        log=el('actionLog'),count=el('scanCount'),resetBtn=el('resetButton'),
        btnWrap=el('lectureButtons');

  /* ---------- State ------------------- */
  let mode='setup',scanned=new Set();

  /* ---------- UI log ------------------ */
  function logMsg(text,type='info'){
    const t=new Date().toLocaleTimeString();
    const icons={success:'âœ…',error:'âŒ',warning:'âš ï¸',info:'â„¹ï¸'};
    const div=document.createElement('div');
    div.className=`log-${type}`;div.innerHTML=`${icons[type]||'ðŸ“'} ${t}: ${text}`;
    log.prepend(div);
  }

  /* ---------- Lecture buttons --------- */
  CFG.LECTURES.forEach(L=>{
    const b=document.createElement('button');
    b.className='lecture-btn';b.textContent=L.n;b.dataset.code=L.c;
    b.onclick=()=>initLecture(L.c,L.n);
    btnWrap.appendChild(b);
  });

  /* ---------- Badge input ------------- */
  badgeIn.addEventListener('keydown',e=>{
    if(e.key!=='Enter')return;
    const val=badgeIn.value.trim();if(!val)return;
    processBadge(val);badgeIn.value='';
    setTimeout(()=>badgeIn.focus(),10);
  });

  /* ---------- Reset button ------------ */
  resetBtn.onclick=()=>confirm('Reset and select a new lecture?')&&reset();

  /* ---------- Init lecture ------------ */
  function initLecture(code,name){
    logMsg(`<strong>ðŸ“š LECTURE SETUP: ${name}</strong>`);
    sendToMedHub(code)
      .then(msg=>{switchToAttendance(name);logMsg(`MedHub: ${msg}`,'success');})
      .catch(err=>logMsg(`Lecture Setup Failed â€“ ${err.message}`,'error'));
  }

  /* ---------- Process badge ----------- */
  function processBadge(id){
    if(scanned.has(id)){logMsg(`DUPLICATE - ID #${id} already scanned`,'warning');return;}
    logMsg(`Processing badge ID #${id}...`);
    sendToMedHub(id)
      .then(msg=>{
        scanned.add(id);count.textContent=`Total scans: ${scanned.size}`;
        cont.classList.add('success-flash');
        setTimeout(()=>cont.classList.remove('success-flash'),CFG.FLASH_TIME);
        logMsg(`ID #${id} recorded. MedHub: ${msg}`,'success');
      })
      .catch(err=>logMsg(`Scan Error for ID #${id} â€“ ${err.message}`,'error'));
  }

  /* ---------- MedHub call ------------- */
  async function sendToMedHub(tid){
    const body=new URLSearchParams({
      deviceid:CFG.DEVICE_ID,sid:CFG.SID,tid,udid:CFG.UDID,userid:CFG.USER_ID
    }).toString();

    const res=await fetch(CFG.MEDHUB_PROXY_URL,{
      method:'POST',
      headers:{'Content-Type':'application/x-www-form-urlencoded'},
      body
    });

    const txt=await res.text();                            // pass full text through
    const statusMatch=txt.match(/<status>(\d)<\/status>/); // 0 = fail, 1 = ok (MedHub spec)
    const msgMatch   =txt.match(/<text>([^<]+)<\/text>/);  // optional human message
    const mhMessage  =msgMatch ? msgMatch[1].trim() : txt.trim();

    if(!res.ok || (statusMatch && statusMatch[1]==='0')){
      throw new Error(mhMessage || `HTTP ${res.status}`);
    }
    return mhMessage || 'Success';
  }

  /* ---------- Mode switches ----------- */
  function switchToAttendance(name){
    mode='attendance';
    cont.classList.replace('setup-mode','attendance-mode');
    status.textContent='RECORDING ATTENDANCE';
    setupSec.classList.add('hidden');attSec.classList.remove('hidden');
    lectureInfo.textContent=`Lecture: ${name}`;badgeIn.focus();
  }

  function reset(){
    mode='setup';
    cont.classList.replace('attendance-mode','setup-mode');
    status.textContent='SELECT LECTURE TYPE';
    setupSec.classList.remove('hidden');attSec.classList.add('hidden');
    scanned.clear();count.textContent='Total scans: 0';
    logMsg('System reset. Ready for new lecture setup.','info');
  }

  /* ---------- Kick-off ---------------- */
  reset(); // initial state
});
</script>
</body>
</html>
